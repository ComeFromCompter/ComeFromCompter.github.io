<!DOCTYPE html><html><head><title>Untitled</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-1" class="wmd-preview-section preview-content">

<p>今天在写得webview加动画的时候发现 WebViewClient的onPageStarted()和onPageFinish()会执行两次，在网上找了一下，发现是url重定向的问题，因此在onPageStarted()和onPageFinish()方法中作了判断，代码如下</p>

</div><div id="wmd-preview-section-2" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebViewClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebViewClient</span> </span>{<br>        MyDialog mDialog = <span class="hljs-keyword">new</span> MyDialog(getActivity(),<br>                R.layout.progessbar_lagout);<br>        <span class="hljs-keyword">int</span> showTime = <span class="hljs-number">1</span>;<span class="hljs-comment">//显示的次数</span><br><br>        <span class="hljs-annotation">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldOverrideUrlLoading</span><span class="hljs-params">(WebView view, String url)</span> </span>{<br>            view.loadUrl(url);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        }<br><br>        <span class="hljs-annotation">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPageStarted</span><span class="hljs-params">(WebView view, String url, Bitmap favicon)</span> </span>{<br>            <span class="hljs-keyword">super</span>.onPageStarted(view, url, favicon);<br>            <span class="hljs-keyword">if</span> (showTime == <span class="hljs-number">2</span>) {<br>                mDialog.show();<br>            } <span class="hljs-keyword">else</span> {<br>                showTime++;<br>            }<br>        }<br><br>        <span class="hljs-annotation">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPageFinished</span><span class="hljs-params">(WebView view, String url)</span> </span>{<br>            <span class="hljs-keyword">super</span>.onPageFinished(view, url);<br>            <span class="hljs-keyword">if</span> (showTime == <span class="hljs-number">2</span>) {<br>                mDialog.dismiss();<br>            } <span class="hljs-keyword">else</span> {<br>                showTime--;<br>            }<br><br>        }<br><br>        <span class="hljs-annotation">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onReceivedError</span><span class="hljs-params">(WebView view, <span class="hljs-keyword">int</span> errorCode,<br>                String description, String failingUrl)</span> </span>{<br>            Log.e(<span class="hljs-string">"yyt"</span>, <span class="hljs-string">"dismiss"</span>);<br>            mDialog.dismiss();<br>            <span class="hljs-keyword">new</span> AlertDialog.Builder(mActivity()).setMessage(description)<br>                    .setPositiveButton(<span class="hljs-string">"ok"</span>, <span class="hljs-keyword">null</span>).create().show();<br>            <span class="hljs-keyword">super</span>.onReceivedError(view, errorCode, description, failingUrl);<br>        }<br>    }<br></code></pre>

<p>之前自己写的Dialog老是因为Context的原因，报空指针异常，现复制一份Dialog，以便以后学习和参考</p>

</div><div id="wmd-preview-section-3" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Dialog</span> </span>{<br><br>    <span class="hljs-comment">// private static int default_width = 220;</span><br>    <span class="hljs-comment">// private static int default_height = 210;</span><br><br>    <span class="hljs-comment">// public MyDialog(Context context, int layout, int style) {</span><br>    <span class="hljs-comment">// this(context, default_width, default_height, layout, style);</span><br>    <span class="hljs-comment">// }</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isShow = <span class="hljs-keyword">false</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Context activity, <span class="hljs-keyword">int</span> layout)</span> </span>{<br>        <span class="hljs-keyword">super</span>(activity, R.style.update_dialog);<br>        <span class="hljs-keyword">try</span> {<br>            setContentView(layout);<br>        } <span class="hljs-keyword">catch</span> (InflateException e) {<br>            e.printStackTrace();<br>        }<br>        setCanceledOnTouchOutside(<span class="hljs-keyword">false</span>);<br>        getWindow().setFlags(WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE,<br>                WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE);<br><br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Context activity, <span class="hljs-keyword">int</span> layout, <span class="hljs-keyword">int</span> gravity)</span> </span>{<br>        <span class="hljs-keyword">this</span>(activity, layout, gravity, <span class="hljs-keyword">false</span>);<br>    }<br><br>    <span class="hljs-comment">/**<br>     * <br>     * <span class="hljs-doctag">@param</span> layout<br>     *            ui布局<br>     * <span class="hljs-doctag">@param</span> gravity<br>     *            显示位置<br>     * <span class="hljs-doctag">@param</span> isShow<br>     *            是否点击屏幕其他地方消失 | 返回键消失<br>     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Context activity, <span class="hljs-keyword">int</span> layout, <span class="hljs-keyword">int</span> gravity, <span class="hljs-keyword">boolean</span> isShow)</span> </span>{<br>        <span class="hljs-keyword">super</span>(activity, R.style.update_dialog);<br>        <span class="hljs-keyword">try</span> {<br>            setContentView(layout);<br>        } <span class="hljs-keyword">catch</span> (InflateException e) {<br>            e.printStackTrace();<br>        }<br>        Window window = getWindow();<br>        WindowManager.LayoutParams params = window.getAttributes();<br>        params.width = ViewGroup.LayoutParams.MATCH_PARENT;<br>        params.height = ViewGroup.LayoutParams.WRAP_CONTENT;<br>        params.gravity = gravity;<br>        window.setAttributes(params);<br>        <span class="hljs-keyword">if</span> (isShow) {<br>            setCanceledOnTouchOutside(<span class="hljs-keyword">true</span>);<br>            <span class="hljs-keyword">this</span>.isShow = isShow;<br>        } <span class="hljs-keyword">else</span> {<br>            setCanceledOnTouchOutside(<span class="hljs-keyword">false</span>);<br>            <span class="hljs-keyword">this</span>.isShow = isShow;<br>        }<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Context activity, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span> layout,<br>            <span class="hljs-keyword">int</span> style)</span> </span>{<br>        <span class="hljs-keyword">super</span>(activity, style);<br>        <span class="hljs-keyword">try</span> {<br>            setContentView(layout);<br>        } <span class="hljs-keyword">catch</span> (InflateException e) {<br>            e.printStackTrace();<br>        }<br>        Window window = getWindow();<br>        WindowManager.LayoutParams params = window.getAttributes();<br>        params.width = width;<br>        params.height = height;<br>        params.gravity = Gravity.CENTER;<br>        window.setAttributes(params);<br>        setCanceledOnTouchOutside(<span class="hljs-keyword">true</span>);<br>    }<br><br>    <span class="hljs-comment">/**<br>     * <br>     * <span class="hljs-doctag">@param</span> layout<br>     * <span class="hljs-doctag">@param</span> style<br>     * <span class="hljs-doctag">@param</span> CanceledOnTouchOutside<br>     *            点击dialog外屏幕,dialog 是否消失 :true ,消失;false, 不消失<br>     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Activity activity, View layout, <span class="hljs-keyword">int</span> style,<br>            <span class="hljs-keyword">boolean</span> CanceledOnTouchOutside)</span> </span>{<br>        <span class="hljs-keyword">super</span>(activity, style);<br>        <span class="hljs-keyword">try</span> {<br>            setContentView(layout, <span class="hljs-keyword">new</span> ViewGroup.LayoutParams(<br>                    ViewGroup.LayoutParams.MATCH_PARENT,<br>                    ViewGroup.LayoutParams.MATCH_PARENT));<br>        } <span class="hljs-keyword">catch</span> (InflateException e) {<br>            e.printStackTrace();<br>        }<br>        setCancelable(<span class="hljs-keyword">true</span>);<span class="hljs-comment">// 可以用“返回键”取消</span><br>        setCanceledOnTouchOutside(CanceledOnTouchOutside);<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyDialog</span><span class="hljs-params">(Activity activity, View layout, <span class="hljs-keyword">int</span> style)</span> </span>{<br>        <span class="hljs-keyword">this</span>(activity, layout, style, <span class="hljs-keyword">true</span>);<br>    }<br><br>    <span class="hljs-annotation">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBackPressed</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">if</span> (isShow) {<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">super</span>.onBackPressed();<br>        }<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> <span class="hljs-title">getDensity</span><span class="hljs-params">(Context context)</span> </span>{<br>        Resources resources = context.getResources();<br>        DisplayMetrics dm = resources.getDisplayMetrics();<br>        <span class="hljs-keyword">return</span> dm.density;<br>    }<br>}<br></code></pre>

<p>style.xml</p>

</div><div id="wmd-preview-section-4" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-xml hljs">  <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"update_dialog"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"@android:style/Theme.Dialog"</span>&gt;</span><span class="css"><br>        &lt;<span class="hljs-tag">item</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">android</span><span class="hljs-pseudo">:windowFrame"</span>&gt;<span class="hljs-at_rule">@<span class="hljs-keyword">null&lt;/item&gt;</span><br>        &lt;item name=<span class="hljs-string">"android:windowIsFloating"</span>&gt;true&lt;/item&gt;<br>        &lt;item name=<span class="hljs-string">"android:windowIsTranslucent"</span>&gt;false&lt;/item&gt;<br>        &lt;item name=<span class="hljs-string">"android:windowNoTitle"</span>&gt;true&lt;/item&gt;<br>        &lt;item name=<span class="hljs-string">"android:backgroundDimEnabled"</span>&gt;true&lt;/item&gt;<br>        &lt;item name=<span class="hljs-string">"android:windowBackground"</span>&gt;@android:color/transparent&lt;/item&gt;<br>    </span></span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span><br></code></pre>

<hr>

<p>关于TextView中部分文字<strong>自定义字体</strong>，<strong>自定义部分文字超链接</strong>的问题 <br>
自定义字体</p>

</div><div id="wmd-preview-section-5" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs">Typeface typeface = Typeface.createFromAsset(context.getAssets(),   <span class="hljs-string">"fonts/PTSans.ttf"</span>);<br><br><span class="hljs-comment">//由于在自定义字体的时候需要每次都这样调用，那么就可以写在一个静态类了</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Typeface typePT;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Typeface typeOM;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title">getTypeFacePT</span><span class="hljs-params">(Context context)</span></span>{<br>        <span class="hljs-keyword">if</span> (typePT == <span class="hljs-keyword">null</span>) {<br>            typePT = Typeface.createFromAsset(context.getAssets(),<br>                    Constants.FONTS_PTSANS);<br>        }<br>        <span class="hljs-keyword">return</span> typePT;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title">getTypeFaceOM</span><span class="hljs-params">(Context context)</span></span>{<br>        <span class="hljs-keyword">if</span> (typeOM == <span class="hljs-keyword">null</span>) {<br>            typeOM = Typeface.createFromAsset(context.getAssets(),<br>                    Constants.FONTS_OMNES);<br>        }<br>        <span class="hljs-keyword">return</span> typeOM;<br>    }<br>    <span class="hljs-comment">//那么在设置字体的时候只需要</span><br>    textView.setTypeface(Constants.getTypeFacePT(context));<br></code></pre>

<p>部分文字超链接</p>

</div><div id="wmd-preview-section-6" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs"><span class="hljs-comment">//获取TextView里的内容</span><br>    SpannableStringBuilder ssb = <span class="hljs-keyword">new</span> SpannableStringBuilder(tvShareBottomDesc.getText().toString());<br>    <span class="hljs-comment">//设置可以点击的部分文字，其中NoLineClickableSpan为自定义，没有下划线的文字</span><br>    ssb.setSpan(<span class="hljs-keyword">new</span> NoLineClickableSpan() {<br><br>            <span class="hljs-annotation">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View widget)</span> </span>{<br>                <span class="hljs-comment">//部分文字的点击事件</span><br>                ComponentsManager.branch(context, Components.AGREEMENT);<br>                dialog.dismiss();<br><br>            }<br>        }, s.indexOf(<span class="hljs-string">"privacy"</span>), s.length(), Spanned.SPAN_EXCLUSIVE_INCLUSIVE);<br>    <span class="hljs-comment">//设置部分文字的样式</span><br>    ssb.setSpan(<br>                <span class="hljs-keyword">new</span> TextAppearanceSpan(<br>                    <span class="hljs-keyword">null</span>, <br>                    Typeface.BOLD, <br>                    ImageSize.inPX(context, <span class="hljs-number">28</span>),<br>                     ColorStateList.valueOf(<span class="hljs-number">0xFFA7AEB6</span>), <br>                     <span class="hljs-keyword">null</span>),<br>                s.indexOf(<span class="hljs-string">"privacy"</span>), s.length(),<br>                Spanned.SPAN_EXCLUSIVE_INCLUSIVE);<br><br>    tvShareBottomDesc.setMovementMethod(LinkMovementMethod.getInstance());<br></code></pre>

<p><strong>NoLineClickableSpan</strong></p>

</div><div id="wmd-preview-section-7" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs"><span class="hljs-comment">//没有下划线的ClickableSpan</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NoLineClickableSpan</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ClickableSpan</span> </span>{<br><br>    <span class="hljs-annotation">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View widget)</span> </span>{<br><br>    }<br><br>    <span class="hljs-annotation">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateDrawState</span><span class="hljs-params">(TextPaint ds)</span> </span>{<br>        <span class="hljs-keyword">super</span>.updateDrawState(ds);<br>        ds.setUnderlineText(<span class="hljs-keyword">false</span>);<br>    }<br>}<br></code></pre>

</div><div id="wmd-preview-section-8" class="wmd-preview-section preview-content"></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>